@model Solicitudes
@{
	ViewData["Title"] = "Solicitudes";
	Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="card">
	<div class="card-header">
		@ViewBag.Accion
	</div>
	<div class="card-body">

		<form asp-action="GuardarNuevasSolicitudes" asp-controller="BandejaAprobador" method="post">

			<input asp-for="Id" type="hidden" />

			<div class="mb-2">
				<label class="form-label">Descripcion</label>
				<input type="text" class="form-control form-control-sm" asp-for="Descripcion" />
			</div>

			<div class="mb-2">
				<label class="form-label">Monto</label>
				<input type="number" step="0.01" class="form-control form-control-sm" placeholder="Monto" asp-for="Monto" />
			</div>


			<div class="mb-2">
				<label class="form-label">Fecha</label>
				<input type="date" class="form-control form-control-sm" asp-for="FechaEsperada" min="@DateTime.Now.ToString("yyyy-MM-dd")" />

			</div>

			<div class="mb-2">
				<label class="form-label">Estado</label>
				<select name="estado" id="estado" class="form-control" style="width: 200px; display: inline-block;">
					<option value="AP">APROBADO</option>
					<option value="PE" selected>PENDIENTE</option>
					<option value="RE">RECHAZADO</option>
				</select>
			</div>

			<div class="mb-2">
				<label class="form-label">Comentario</label>
				<textarea name="Comentario" id="Comentario" class="form-control" rows="2" placeholder="Comentario..."></textarea>
			</div>

			<button type="submit" class="btn btn-success btn-sm" onclick="return validarGuardado()">Guardar</button>

			<a asp-action="Index" asp-controller="BandejaAprobador" class="btn btn-warning btn-sm">volver</a>

		</form>

		<hr />

	</div>
</div>

@section Scripts {
	<script>
		function validarGuardado() {
			const estado = document.getElementById("estado").value;
			const monto = parseFloat(document.getElementById("Monto").value);
			const comentario = document.getElementById("Comentario").value.trim();

			if (estado === "AP" && monto > 5000 && comentario === "") {
				alert("Debe ingresar un comentario si aprueba montos mayores a $5000.");
				return false; // No envía el formulario
			}

			return true; // Permite el envío
		}
	</script>
}